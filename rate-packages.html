<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rate Packages - Keyquest Admin</title>
    <link rel="stylesheet" href="css/admin-styles.css">
    <!-- CRITICAL: Load Supabase library BEFORE config -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="page-rate-packages">
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <h2>Keyquest</h2>
                </div>
                <button class="sidebar-toggle" onclick="closeSidebar()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            
            <nav class="sidebar-nav">
                <a href="index.html" class="nav-item">
                    <i data-lucide="layout-dashboard"></i>
                    <span>Dashboard</span>
                </a>
                <a href="rate-packages.html" class="nav-item active">
                    <i data-lucide="package"></i>
                    <span>Rate Package</span>
                </a>
                <a href="rate-types.html" class="nav-item">
                    <i data-lucide="percent"></i>
                    <span>Rate Type</span>
                </a>
                <a href="banks.html" class="nav-item">
                    <i data-lucide="landmark"></i>
                    <span>Bank</span>
                </a>
                <a href="bankers.html" class="nav-item">
                    <i data-lucide="users"></i>
                    <span>Bankers</span>
                </a>
                <a href="agents.html" class="nav-item">
                    <i data-lucide="user-check"></i>
                    <span>Agents</span>
                </a>
                <a href="enquiry.html" class="nav-item">
                    <i data-lucide="message-circle"></i>
                    <span>Enquiry</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Fixed Header Structure - matching dashboard exactly -->
            <header class="main-header">
                <div class="header-left">
                    <button class="sidebar-toggle mobile-only" onclick="toggleSidebar()">
                        <i data-lucide="menu"></i>
                    </button>
                    <h1 class="header-title">Rate Packages</h1>
                </div>
                <div class="header-right">
                    <button class="btn btn-primary" onclick="openModal('package-modal')">
                        <i data-lucide="plus"></i>
                        <span>Add Rate Package</span>
                    </button>
                    <button class="btn btn-secondary" onclick="confirmSignOut()">
                        <i data-lucide="log-out"></i>
                        <span>Sign Out</span>
                    </button>
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar">A</div>
                        <div class="user-info">
                            <div class="user-name" id="userName">admin</div>
                            <div class="user-role">Super Admin</div>
                        </div>
                    </div>
                </div>
            </header>

            <div class="content-area">
                <!-- Fixed Search and Filter Bar (Matching Original Design) -->
                <div class="search-filter-bar">
                    <div class="search-box">
                        <i data-lucide="search" class="search-icon"></i>
                        <input type="text" class="search-input" placeholder="Search rate packages..." id="searchInput">
                    </div>
                    
                    <select class="filter-select" id="propertyTypeFilter">
                        <option value="">Select Property Type</option>
                        <option value="HDB">HDB</option>
                        <option value="Private Property">Private Property</option>
                        <option value="EC">EC</option>
                        <option value="Commercial">Commercial</option>
                        <option value="Industrial">Industrial</option>
                    </select>

                    <select class="filter-select" id="buyUnderFilter">
                        <option value="">Select Buy Under</option>
                        <option value="Company Operating">Company Operating</option>
                        <option value="Company Investment Holding">Company Investment Holding</option>
                        <option value="Individual Name">Individual Name</option>
                    </select>

                    <select class="filter-select" id="loanTypeFilter">
                        <option value="">Select Loan Type</option>
                        <option value="New Home Loan">New Home Loan</option>
                        <option value="Refinancing Home Loan">Refinancing Home Loan</option>
                        <option value="Commercial/Industrial">Commercial/Industrial</option>
                    </select>

                    <select class="filter-select" id="rateTypeFilter">
                        <option value="">Select Rate Type</option>
                        <option value="FIXED">Fixed</option>
                        <option value="FLOATING">Floating</option>
                    </select>

                    <select class="filter-select" id="lockPeriodFilter">
                        <option value="">Select Lock In Period</option>
                        <option value="0 Year">0 Year</option>
                        <option value="1 Year">1 Year</option>
                        <option value="2 Years">2 Years</option>
                        <option value="3 Years">3 Years</option>
                        <option value="4 Years">4 Years</option>
                        <option value="5 Years">5 Years</option>
                    </select>

                    <select class="filter-select" id="loanAmountFilter">
                        <option value="">Select Loan Amount</option>
                        <option value="100000">$100,000</option>
                        <option value="200000">$200,000</option>
                        <option value="250000">$250,000</option>
                        <option value="300000">$300,000</option>
                        <option value="400000">$400,000</option>
                        <option value="500000">$500,000</option>
                        <option value="600000">$600,000</option>
                        <option value="700000">$700,000</option>
                        <option value="750000">$750,000</option>
                        <option value="800000">$800,000</option>
                        <option value="900000">$900,000</option>
                        <option value="1000000">$1,000,000</option>
                        <option value="1200000">$1,200,000</option>
                        <option value="1500000">$1,500,000</option>
                        <option value="2000000">$2,000,000</option>
                    </select>

                    <select class="filter-select" id="bankFilter">
                        <option value="">Select Bank</option>
                        <!-- Banks will be populated dynamically -->
                    </select>

                    <button class="btn btn-secondary" onclick="clearAllFilters()" title="Clear all filters">
                        <i data-lucide="filter"></i>
                        <span>Clear</span>
                    </button>

                    <button class="btn btn-secondary" onclick="exportData()" title="Export data">
                        <i data-lucide="download"></i>
                        <span>Export</span>
                    </button>
                </div>

                <!-- Enhanced Table -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Bank Name</th>
                                <th>Property Type</th>
                                <th>Buy Under</th>
                                <th>Reference Rate</th>
                                <th>Property Status</th>
                                <th>Rate Type</th>
                                <th>Loan Amount</th>
                                <th>Loan Type</th>
                                <th>Lock In Period</th>
                                <th>Interest Y1</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="packagesTableBody">
                            <tr>
                                <td colspan="11" class="loading-row">
                                    <div class="loading-spinner"></div>
                                    Loading rate packages...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Enhanced Pagination -->
                <div class="pagination" id="pagination">
                    <div class="pagination-info">
                        Showing <span id="paginationInfo">0-0 of 0</span>
                    </div>
                    <div class="pagination-controls" id="paginationControls">
                        <!-- Pagination buttons will be generated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Overlay for mobile sidebar -->
    <div class="overlay" id="overlay" onclick="closeSidebar()"></div>

    <!-- Rate Package Modal -->
    <div class="modal" id="package-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="modalTitle">Add Rate Package</h3>
                <button class="modal-close" onclick="closeModal('package-modal')">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="packageForm" class="package-form">
                    <div class="form-grid">
                        <!-- Basic Information -->
                        <div class="form-group">
                            <label for="bank_name">Bank Name *</label>
                            <select id="bank_name" name="bank_name" class="form-input" required>
                                <option value="">Select Bank</option>
                                <!-- Banks will be populated dynamically -->
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="property_type">Property Type *</label>
                            <select id="property_type" name="property_type" class="form-input" required>
                                <option value="">Select Property Type</option>
                                <option value="HDB">HDB</option>
                                <option value="Private Property">Private Property</option>
                                <option value="EC">EC</option>
                                <option value="Commercial">Commercial</option>
                                <option value="Industrial">Industrial</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="buy_under">Buy Under *</label>
                            <select id="buy_under" name="buy_under" class="form-input" required>
                                <option value="">Select Buy Under</option>
                                <option value="Company Operating">Company Operating</option>
                                <option value="Company Investment Holding">Company Investment Holding</option>
                                <option value="Individual Name">Individual Name</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="reference_rate">Reference Rate *</label>
                            <input type="text" id="reference_rate" name="reference_rate" class="form-input" required placeholder="e.g., 3M SORA, 6M SORA, etc.">
                        </div>

                        <div class="form-group">
                            <label for="property_status">Property Status *</label>
                            <select id="property_status" name="property_status" class="form-input" required>
                                <option value="">Select Property Status</option>
                                <option value="COMPLETED">Completed</option>
                                <option value="UNDER CONSTRUCTION">Under Construction</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="rate_type_category">Rate Type *</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="rate_fixed" name="rate_type_category" value="FIXED">
                                    <label for="rate_fixed">Fixed</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="rate_floating" name="rate_type_category" value="FLOATING">
                                    <label for="rate_floating">Floating</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="loan_amount">Loan Amount *</label>
                            <select id="loan_amount" name="loan_amount" class="form-input" required>
                                <option value="">Select Loan Amount</option>
                                <option value="100000">$100,000</option>
                                <option value="200000">$200,000</option>
                                <option value="250000">$250,000</option>
                                <option value="300000">$300,000</option>
                                <option value="400000">$400,000</option>
                                <option value="500000">$500,000</option>
                                <option value="600000">$600,000</option>
                                <option value="700000">$700,000</option>
                                <option value="750000">$750,000</option>
                                <option value="800000">$800,000</option>
                                <option value="900000">$900,000</option>
                                <option value="1000000">$1,000,000</option>
                                <option value="1200000">$1,200,000</option>
                                <option value="1500000">$1,500,000</option>
                                <option value="2000000">$2,000,000</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="loan_type">Loan Type *</label>
                            <select id="loan_type" name="loan_type" class="form-input" required>
                                <option value="">Select Loan Type</option>
                                <option value="New Home Loan">New Home Loan</option>
                                <option value="Refinancing Home Loan">Refinancing Home Loan</option>
                                <option value="Commercial/Industrial">Commercial/Industrial</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="lock_period">Lock In Period *</label>
                            <select id="lock_period" name="lock_period" class="form-input" required>
                                <option value="">Select Lock Period</option>
                                <option value="0 Year">0 Year</option>
                                <option value="1 Year">1 Year</option>
                                <option value="2 Years">2 Years</option>
                                <option value="3 Years">3 Years</option>
                                <option value="4 Years">4 Years</option>
                                <option value="5 Years">5 Years</option>
                                <option value="6 Years">6 Years</option>
                                <option value="7 Years">7 Years</option>
                                <option value="8 Years">8 Years</option>
                                <option value="9 Years">9 Years</option>
                                <option value="10 Years">10 Years</option>
                            </select>
                        </div>

                        <!-- Interest Rate Information -->
                        <div class="form-group" style="grid-column: span 2;">
                            <h4 style="margin-bottom: 16px; color: #1e293b;">Interest Rate Information</h4>
                            <div id="rateYearInputs">
                                <!-- Year 1 -->
                                <div class="rate-year-row">
                                    <h5>Year 1 *</h5>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                        <div>
                                            <label for="year1_rate_type">Rate Type</label>
                                            <select id="year1_rate_type" name="year1_rate_type" class="form-input" required>
                                                <option value="">Select Rate Type</option>
                                                <!-- Will be populated from rate_types table -->
                                            </select>
                                        </div>
                                        <div>
                                            <label for="year1_rate_value">Rate Value (%)</label>
                                            <div class="input-group">
                                                <input type="number" id="year1_rate_value" name="year1_rate_value" 
                                                       class="form-input" step="0.01" min="0" max="100" required>
                                                <span class="input-suffix">%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Year 2 -->
                                <div class="rate-year-row">
                                    <h5>Year 2</h5>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                        <div>
                                            <label for="year2_rate_type">Rate Type</label>
                                            <select id="year2_rate_type" name="year2_rate_type" class="form-input">
                                                <option value="">Select Rate Type</option>
                                                <!-- Will be populated from rate_types table -->
                                            </select>
                                        </div>
                                        <div>
                                            <label for="year2_rate_value">Rate Value (%)</label>
                                            <div class="input-group">
                                                <input type="number" id="year2_rate_value" name="year2_rate_value" 
                                                       class="form-input" step="0.01" min="0" max="100">
                                                <span class="input-suffix">%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Year 3 -->
                                <div class="rate-year-row">
                                    <h5>Year 3</h5>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                        <div>
                                            <label for="year3_rate_type">Rate Type</label>
                                            <select id="year3_rate_type" name="year3_rate_type" class="form-input">
                                                <option value="">Select Rate Type</option>
                                                <!-- Will be populated from rate_types table -->
                                            </select>
                                        </div>
                                        <div>
                                            <label for="year3_rate_value">Rate Value (%)</label>
                                            <div class="input-group">
                                                <input type="number" id="year3_rate_value" name="year3_rate_value" 
                                                       class="form-input" step="0.01" min="0" max="100">
                                                <span class="input-suffix">%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Year 4 -->
                                <div class="rate-year-row">
                                    <h5>Year 4</h5>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                        <div>
                                            <label for="year4_rate_type">Rate Type</label>
                                            <select id="year4_rate_type" name="year4_rate_type" class="form-input">
                                                <option value="">Select Rate Type</option>
                                                <!-- Will be populated from rate_types table -->
                                            </select>
                                        </div>
                                        <div>
                                            <label for="year4_rate_value">Rate Value (%)</label>
                                            <div class="input-group">
                                                <input type="number" id="year4_rate_value" name="year4_rate_value" 
                                                       class="form-input" step="0.01" min="0" max="100">
                                                <span class="input-suffix">%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Year 5 -->
                                <div class="rate-year-row">
                                    <h5>Year 5</h5>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                        <div>
                                            <label for="year5_rate_type">Rate Type</label>
                                            <select id="year5_rate_type" name="year5_rate_type" class="form-input">
                                                <option value="">Select Rate Type</option>
                                                <!-- Will be populated from rate_types table -->
                                            </select>
                                        </div>
                                        <div>
                                            <label for="year5_rate_value">Rate Value (%)</label>
                                            <div class="input-group">
                                                <input type="number" id="year5_rate_value" name="year5_rate_value" 
                                                       class="form-input" step="0.01" min="0" max="100">
                                                <span class="input-suffix">%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Thereafter -->
                                <div class="rate-year-row">
                                    <h5>Thereafter</h5>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                        <div>
                                            <label for="thereafter_rate_type">Rate Type</label>
                                            <select id="thereafter_rate_type" name="thereafter_rate_type" class="form-input">
                                                <option value="">Select Rate Type</option>
                                                <!-- Will be populated from rate_types table -->
                                            </select>
                                        </div>
                                        <div>
                                            <label for="thereafter_rate_value">Rate Value (%)</label>
                                            <div class="input-group">
                                                <input type="number" id="thereafter_rate_value" name="thereafter_rate_value" 
                                                       class="form-input" step="0.01" min="0" max="100">
                                                <span class="input-suffix">%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Information -->
                        <div class="form-group" style="grid-column: span 2;">
                            <h4 style="margin-bottom: 16px; color: #1e293b;">Package Features</h4>
                            <div class="checkbox-group">
                                <div class="checkbox-option">
                                    <input type="checkbox" id="legal_fee_subsidy" name="legal_fee_subsidy">
                                    <label for="legal_fee_subsidy">Legal Fee Subsidy</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="valuation_subsidy" name="valuation_subsidy">
                                    <label for="valuation_subsidy">Valuation Subsidy</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="partial_repayment" name="partial_repayment">
                                    <label for="partial_repayment">Partial Repayment</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="waiver_due_to_sales" name="waiver_due_to_sales">
                                    <label for="waiver_due_to_sales">Waiver Due to Sales</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="free_package_conversion_12m" name="free_package_conversion_12m">
                                    <label for="free_package_conversion_12m">Free Package Conversion (12 Months)</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="free_package_conversion_24m" name="free_package_conversion_24m">
                                    <label for="free_package_conversion_24m">Free Package Conversion (24 Months)</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="free_package_conversion_36m" name="free_package_conversion_36m">
                                    <label for="free_package_conversion_36m">Free Package Conversion (36 Months)</label>
                                </div>
                            </div>
                        </div>

                        <!-- Remarks -->
                        <div class="form-group" style="grid-column: span 2;">
                            <label for="remarks">Remarks</label>
                            <textarea id="remarks" name="remarks" class="form-input" rows="3" placeholder="Additional notes or remarks..."></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('package-modal')">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="savePackage()">
                    <span id="saveButtonText">Save Package</span>
                    <div id="saveButtonSpinner" class="loading-spinner" style="display: none;"></div>
                </button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="signout-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirm Sign Out</h3>
                <button class="modal-close" onclick="closeModal('signout-modal')">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to sign out? You will be redirected to the login page.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('signout-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="performSignOut()">
                    <i data-lucide="log-out"></i>
                    Sign Out
                </button>
            </div>
        </div>
    </div>

    <!-- Load configuration and scripts -->
    <script src="config/supabase.js"></script>
    <script src="js/admin-scripts.js"></script>
    <script src="js/lucide.min.js"></script>
    
    <script>
        console.log('🚀 Initializing Enhanced Rate Packages page...');
        
        // Enhanced global variables
        let currentPage = 1;
        let itemsPerPage = 10;
        let allPackages = [];
        let filteredPackages = [];
        let allBanks = [];
        let allRateTypes = [];
        let isLoading = false;

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('✅ Supabase client loaded successfully');
            
            // Initialize Lucide icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Check authentication
            await checkAuthentication();
            
            // Load initial data
            await loadInitialData();
            
            // Setup event listeners
            setupEventListeners();
        });

        // Check authentication
        async function checkAuthentication() {
            try {
                console.log('🔄 Loading packages from Supabase...');
                const { user } = await AuthService.getCurrentUser();
                if (!user) {
                    window.location.href = 'login.html';
                    return;
                }
                
                // Update user info in header
                const userName = document.getElementById('userName');
                const userAvatar = document.getElementById('userAvatar');
                
                if (userName && user.email) {
                    userName.textContent = user.email.split('@')[0];
                }
                if (userAvatar && user.email) {
                    userAvatar.textContent = user.email.charAt(0).toUpperCase();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                window.location.href = 'login.html';
            }
        }

        // Load initial data
        async function loadInitialData() {
            try {
                showLoading(true);
                
                // Load packages, banks, and rate types in parallel
                await Promise.all([
                    loadPackages(),
                    loadBanks(),
                    loadRateTypes()
                ]);
                
                // Apply initial filters and render
                applyFilters();
                
            } catch (error) {
                console.error('Failed to load initial data:', error);
                showNotification('Failed to load data. Please refresh the page.', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Load packages from Supabase
        async function loadPackages() {
            try {
                const { data, error } = await supabaseClient
                    .from('rate_packages')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                allPackages = data || [];
                console.log('✅ Loaded packages:', allPackages.length, 'records');
                
            } catch (error) {
                console.error('Error loading packages:', error);
                throw error;
            }
        }

        // Load banks for filters and forms
        async function loadBanks() {
            try {
                const { data, error } = await supabaseClient
                    .from('banks')
                    .select('*')
                    .order('name');

                if (error) throw error;

                allBanks = data || [];
                populateBankSelects();
                
            } catch (error) {
                console.error('Error loading banks:', error);
            }
        }

        // Load rate types for forms
        async function loadRateTypes() {
            try {
                const { data, error } = await supabaseClient
                    .from('rate_types')
                    .select('*')
                    .order('rate_type');

                if (error) throw error;

                allRateTypes = data || [];
                populateRateTypeSelects();
                
            } catch (error) {
                console.error('Error loading rate types:', error);
            }
        }

        // Populate bank select elements
        function populateBankSelects() {
            const bankSelects = ['bankFilter', 'bank_name'];
            
            bankSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    // Clear existing options (except first one)
                    const firstOption = select.firstElementChild;
                    select.innerHTML = '';
                    select.appendChild(firstOption);
                    
                    // Add bank options
                    allBanks.forEach(bank => {
                        const option = document.createElement('option');
                        option.value = bank.name;
                        option.textContent = bank.name;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Populate rate type select elements
        function populateRateTypeSelects() {
            const rateTypeSelects = [
                'year1_rate_type', 'year2_rate_type', 'year3_rate_type', 
                'year4_rate_type', 'year5_rate_type', 'thereafter_rate_type'
            ];
            
            rateTypeSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    // Clear existing options (except first one)
                    const firstOption = select.firstElementChild;
                    select.innerHTML = '';
                    select.appendChild(firstOption);
                    
                    // Add rate type options
                    allRateTypes.forEach(rateType => {
                        const option = document.createElement('option');
                        option.value = rateType.rate_type;
                        option.textContent = rateType.rate_type;
                        select.appendChild(option);
                    });
                }
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search input with debounce
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                let searchTimeout;
                searchInput.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        applyFilters();
                    }, 300);
                });
            }

            // Filter selects
            const filterIds = [
                'propertyTypeFilter', 'buyUnderFilter', 'loanTypeFilter', 
                'rateTypeFilter', 'lockPeriodFilter', 'loanAmountFilter', 'bankFilter'
            ];
            
            filterIds.forEach(filterId => {
                const element = document.getElementById(filterId);
                if (element) {
                    element.addEventListener('change', applyFilters);
                }
            });
        }

        // Apply filters and search
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput')?.value?.toLowerCase() || '';
            const propertyType = document.getElementById('propertyTypeFilter')?.value || '';
            const buyUnder = document.getElementById('buyUnderFilter')?.value || '';
            const loanType = document.getElementById('loanTypeFilter')?.value || '';
            const rateType = document.getElementById('rateTypeFilter')?.value || '';
            const lockPeriod = document.getElementById('lockPeriodFilter')?.value || '';
            const loanAmount = document.getElementById('loanAmountFilter')?.value || '';
            const bank = document.getElementById('bankFilter')?.value || '';

            filteredPackages = allPackages.filter(pkg => {
                // Search term filter
                if (searchTerm) {
                    const searchableText = `
                        ${pkg.bank_name || ''} 
                        ${pkg.property_type || ''} 
                        ${pkg.buy_under || ''} 
                        ${pkg.reference_rate || ''} 
                        ${pkg.loan_type || ''}
                    `.toLowerCase();
                    
                    if (!searchableText.includes(searchTerm)) {
                        return false;
                    }
                }

                // Individual filters
                if (propertyType && pkg.property_type !== propertyType) return false;
                if (buyUnder && pkg.buy_under !== buyUnder) return false;
                if (loanType && pkg.loan_type !== loanType) return false;
                if (rateType && pkg.rate_type_category !== rateType) return false;
                if (lockPeriod && pkg.lock_period !== lockPeriod) return false;
                if (loanAmount && pkg.loan_amount !== parseInt(loanAmount)) return false;
                if (bank && pkg.bank_name !== bank) return false;

                return true;
            });

            // Reset to first page and render
            currentPage = 1;
            renderTable();
            renderPagination();
        }

        // Clear all filters
        function clearAllFilters() {
            // Clear search input
            const searchInput = document.getElementById('searchInput');
            if (searchInput) searchInput.value = '';

            // Clear all filter selects
            const filterIds = [
                'propertyTypeFilter', 'buyUnderFilter', 'loanTypeFilter', 
                'rateTypeFilter', 'lockPeriodFilter', 'loanAmountFilter', 'bankFilter'
            ];
            
            filterIds.forEach(filterId => {
                const element = document.getElementById(filterId);
                if (element) element.value = '';
            });

            // Reapply filters (will show all packages)
            applyFilters();
        }

        // Render table with current page data
        function renderTable() {
            const tbody = document.getElementById('packagesTableBody');
            if (!tbody) return;

            if (filteredPackages.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" class="no-data">
                            <div style="text-align: center; padding: 40px; color: #64748b;">
                                <i data-lucide="package" style="width: 48px; height: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                                <p>No rate packages found</p>
                                <p style="font-size: 14px;">Try adjusting your search criteria or add a new package.</p>
                            </div>
                        </td>
                    </tr>
                `;
                // Recreate icons for the empty state
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
                return;
            }

            // Calculate pagination
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = filteredPackages.slice(startIndex, endIndex);

            // Render table rows
            tbody.innerHTML = pageData.map(pkg => `
                <tr>
                    <td>${pkg.bank_name || 'N/A'}</td>
                    <td>${pkg.property_type || 'N/A'}</td>
                    <td>${pkg.buy_under || 'N/A'}</td>
                    <td>${pkg.reference_rate || 'N/A'}</td>
                    <td>
                        <span class="status-badge ${pkg.property_status === 'COMPLETED' ? 'status-completed' : 'status-pending'}">
                            ${pkg.property_status || 'N/A'}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge ${pkg.rate_type_category === 'FIXED' ? 'status-completed' : 'status-pending'}">
                            ${pkg.rate_type_category || 'N/A'}
                        </span>
                    </td>
                    <td>${formatNumber(pkg.loan_amount)}</td>
                    <td>${pkg.loan_type || 'N/A'}</td>
                    <td>${pkg.lock_period || 'N/A'}</td>
                    <td>${calculateInterestY1(pkg)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-info" onclick="duplicatePackage('${pkg.id}')" title="Duplicate" style="background: #f59e0b; color: white; border: none;">
                                <i data-lucide="copy"></i>
                            </button>
                            <button class="btn btn-sm btn-view" onclick="viewPackage('${pkg.id}')" title="View" style="background: #8b5cf6; color: white; border: none;">
                                <i data-lucide="eye"></i>
                            </button>
                            <button class="btn btn-sm btn-edit" onclick="editPackage('${pkg.id}')" title="Edit" style="background: #3b82f6; color: white; border: none;">
                                <i data-lucide="edit"></i>
                            </button>
                            <button class="btn btn-sm btn-delete" onclick="deletePackage('${pkg.id}')" title="Delete" style="background: #ef4444; color: white; border: none;">
                                <i data-lucide="trash-2"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            // Reinitialize Lucide icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // Render pagination controls
        function renderPagination() {
            const totalPages = Math.ceil(filteredPackages.length / itemsPerPage);
            const paginationInfo = document.getElementById('paginationInfo');
            const paginationControls = document.getElementById('paginationControls');

            if (!paginationInfo || !paginationControls) return;

            // Update info
            const startItem = filteredPackages.length === 0 ? 0 : (currentPage - 1) * itemsPerPage + 1;
            const endItem = Math.min(currentPage * itemsPerPage, filteredPackages.length);
            paginationInfo.textContent = `${startItem}-${endItem} of ${filteredPackages.length}`;

            // Generate pagination controls
            if (totalPages <= 1) {
                paginationControls.innerHTML = '';
                return;
            }

            let paginationHTML = '';

            // Previous button
            paginationHTML += `
                <button class="pagination-btn" ${currentPage === 1 ? 'disabled' : ''} 
                        onclick="changePage(${currentPage - 1})">
                    <i data-lucide="chevron-left"></i>
                    Previous
                </button>
            `;

            // Page numbers
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }

            if (startPage > 1) {
                paginationHTML += `<button class="pagination-btn" onclick="changePage(1)">1</button>`;
                if (startPage > 2) {
                    paginationHTML += `<span class="pagination-ellipsis">...</span>`;
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <button class="pagination-btn ${i === currentPage ? 'active' : ''}" 
                            onclick="changePage(${i})">${i}</button>
                `;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += `<span class="pagination-ellipsis">...</span>`;
                }
                paginationHTML += `<button class="pagination-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
            }

            // Next button
            paginationHTML += `
                <button class="pagination-btn" ${currentPage === totalPages ? 'disabled' : ''} 
                        onclick="changePage(${currentPage + 1})">
                    Next
                    <i data-lucide="chevron-right"></i>
                </button>
            `;

            paginationControls.innerHTML = paginationHTML;

            // Reinitialize icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // Change page
        function changePage(page) {
            const totalPages = Math.ceil(filteredPackages.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderTable();
                renderPagination();
            }
        }

        // Calculate Interest Y1
        function calculateInterestY1(pkg) {
            if (pkg.year1_rate_value) {
                return `${pkg.year1_rate_value}%`;
            }
            return 'N/A';
        }

        // Format number as currency
        function formatNumber(amount) {
            if (!amount) return 'N/A';
            return new Intl.NumberFormat('en-SG', {
                style: 'currency',
                currency: 'SGD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // Package management functions
        function duplicatePackage(id) {
            const pkg = allPackages.find(p => p.id === id);
            if (pkg) {
                // Open modal with package data (excluding id and timestamps)
                openPackageModal(null, { ...pkg, id: null });
            }
        }

        function viewPackage(id) {
            const pkg = allPackages.find(p => p.id === id);
            if (pkg) {
                // Open modal in view-only mode
                openPackageModal(id, pkg, true);
            }
        }

        function editPackage(id) {
            const pkg = allPackages.find(p => p.id === id);
            if (pkg) {
                openPackageModal(id, pkg);
            }
        }

        async function deletePackage(id) {
            if (confirm('Are you sure you want to delete this rate package?')) {
                try {
                    showLoading(true);
                    
                    const { error } = await supabaseClient
                        .from('rate_packages')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;

                    showNotification('Package deleted successfully', 'success');
                    await loadPackages();
                    applyFilters();
                    
                } catch (error) {
                    console.error('Error deleting package:', error);
                    showNotification('Failed to delete package', 'error');
                } finally {
                    showLoading(false);
                }
            }
        }

        // Modal functions
        function openModal(modalId) {
            if (modalId === 'package-modal') {
                openPackageModal();
            } else {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'flex';
                }
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                
                if (modalId === 'package-modal') {
                    resetPackageForm();
                }
            }
        }

        function openPackageModal(packageId = null, packageData = null, viewOnly = false) {
            const modal = document.getElementById('package-modal');
            const modalTitle = document.getElementById('modalTitle');
            const form = document.getElementById('packageForm');
            
            if (!modal || !modalTitle || !form) return;

            // Set editing state
            window.AdminApp = window.AdminApp || {};
            window.AdminApp.editingItemId = packageId;

            // Update modal title
            if (viewOnly) {
                modalTitle.textContent = 'View Rate Package';
            } else if (packageId) {
                modalTitle.textContent = 'Edit Rate Package';
            } else {
                modalTitle.textContent = 'Add Rate Package';
            }

            // Reset form first
            resetPackageForm();

            // Populate form if editing/viewing
            if (packageData) {
                populatePackageForm(packageData);
            }

            // Disable form if view-only
            if (viewOnly) {
                const inputs = form.querySelectorAll('input, select, textarea');
                inputs.forEach(input => input.disabled = true);
                
                const saveButton = document.querySelector('#package-modal .btn-primary');
                if (saveButton) saveButton.style.display = 'none';
            } else {
                const inputs = form.querySelectorAll('input, select, textarea');
                inputs.forEach(input => input.disabled = false);
                
                const saveButton = document.querySelector('#package-modal .btn-primary');
                if (saveButton) saveButton.style.display = 'inline-flex';
            }

            modal.style.display = 'flex';
        }

        function resetPackageForm() {
            const form = document.getElementById('packageForm');
            if (form) {
                form.reset();
                
                // Clear specific fields that might not reset properly
                const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(cb => cb.checked = false);
                
                const radios = form.querySelectorAll('input[type="radio"]');
                radios.forEach(radio => radio.checked = false);
            }
        }

        function populatePackageForm(data) {
            const form = document.getElementById('packageForm');
            if (!form || !data) return;

            Object.keys(data).forEach(key => {
                const element = form.querySelector(`[name="${key}"]`);
                if (element) {
                    if (element.type === 'checkbox') {
                        element.checked = Boolean(data[key]);
                    } else if (element.type === 'radio') {
                        if (element.value === data[key]) {
                            element.checked = true;
                        }
                    } else {
                        element.value = data[key] || '';
                    }
                }
            });
        }

        async function savePackage() {
            const form = document.getElementById('packageForm');
            if (!form) return;

            try {
                showSaveLoading(true);

                // Get form data
                const formData = new FormData(form);
                const packageData = {};
                
                // Convert FormData to object
                for (let [key, value] of formData.entries()) {
                    packageData[key] = value;
                }

                // Handle checkboxes (they won't be in FormData if unchecked)
                const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(cb => {
                    packageData[cb.name] = cb.checked;
                });

                // Convert numeric fields
                if (packageData.loan_amount) {
                    packageData.loan_amount = parseInt(packageData.loan_amount);
                }

                // Convert rate values to numbers
                ['year1_rate_value', 'year2_rate_value', 'year3_rate_value', 
                 'year4_rate_value', 'year5_rate_value', 'thereafter_rate_value'].forEach(field => {
                    if (packageData[field]) {
                        packageData[field] = parseFloat(packageData[field]);
                    }
                });

                // Validate required fields
                const requiredFields = ['bank_name', 'property_type', 'buy_under', 'reference_rate', 
                                      'property_status', 'rate_type_category', 'loan_amount', 
                                      'loan_type', 'lock_period', 'year1_rate_type', 'year1_rate_value'];
                
                for (let field of requiredFields) {
                    if (!packageData[field] && packageData[field] !== 0) {
                        throw new Error(`${field.replace('_', ' ')} is required`);
                    }
                }

                let result;
                if (window.AdminApp.editingItemId) {
                    // Update existing package
                    result = await supabaseClient
                        .from('rate_packages')
                        .update(packageData)
                        .eq('id', window.AdminApp.editingItemId);
                } else {
                    // Create new package
                    result = await supabaseClient
                        .from('rate_packages')
                        .insert([packageData]);
                }

                if (result.error) throw result.error;

                showNotification(
                    window.AdminApp.editingItemId ? 'Package updated successfully' : 'Package created successfully', 
                    'success'
                );
                
                closeModal('package-modal');
                await loadPackages();
                applyFilters();
                
            } catch (error) {
                console.error('Error saving package:', error);
                showNotification(error.message || 'Failed to save package', 'error');
            } finally {
                showSaveLoading(false);
            }
        }

        // UI helper functions
        function showLoading(show) {
            const tbody = document.getElementById('packagesTableBody');
            if (!tbody) return;

            if (show) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" class="loading-row">
                            <div class="loading-spinner"></div>
                            Loading rate packages...
                        </td>
                    </tr>
                `;
            }
        }

        function showSaveLoading(show) {
            const saveButtonText = document.getElementById('saveButtonText');
            const saveButtonSpinner = document.getElementById('saveButtonSpinner');
            const saveButton = document.querySelector('#package-modal .btn-primary');
            
            if (saveButton) saveButton.disabled = show;
            if (saveButtonText) saveButtonText.style.display = show ? 'none' : 'inline';
            if (saveButtonSpinner) saveButtonSpinner.style.display = show ? 'block' : 'none';
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span>${message}</span>
                    <button class="notification-close" onclick="this.parentElement.parentElement.remove()">
                        <i data-lucide="x"></i>
                    </button>
                </div>
            `;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Initialize icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // Export functionality
        function exportData() {
            try {
                const csvContent = generateCSV(filteredPackages);
                downloadCSV(csvContent, 'rate-packages.csv');
                showNotification('Data exported successfully', 'success');
            } catch (error) {
                console.error('Export error:', error);
                showNotification('Failed to export data', 'error');
            }
        }

        function generateCSV(data) {
            if (!data || data.length === 0) return '';

            const headers = [
                'Bank Name', 'Property Type', 'Buy Under', 'Reference Rate', 
                'Property Status', 'Rate Type', 'Loan Amount', 'Loan Type', 
                'Lock Period', 'Year 1 Rate', 'Year 2 Rate', 'Year 3 Rate',
                'Year 4 Rate', 'Year 5 Rate', 'Thereafter Rate'
            ];

            const csvRows = [headers.join(',')];

            data.forEach(pkg => {
                const row = [
                    `"${pkg.bank_name || ''}"`,
                    `"${pkg.property_type || ''}"`,
                    `"${pkg.buy_under || ''}"`,
                    `"${pkg.reference_rate || ''}"`,
                    `"${pkg.property_status || ''}"`,
                    `"${pkg.rate_type_category || ''}"`,
                    pkg.loan_amount || '',
                    `"${pkg.loan_type || ''}"`,
                    `"${pkg.lock_period || ''}"`,
                    pkg.year1_rate_value || '',
                    pkg.year2_rate_value || '',
                    pkg.year3_rate_value || '',
                    pkg.year4_rate_value || '',
                    pkg.year5_rate_value || '',
                    pkg.thereafter_rate_value || ''
                ];
                csvRows.push(row.join(','));
            });

            return csvRows.join('\n');
        }

        function downloadCSV(csvContent, filename) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // Sign out functionality
        function confirmSignOut() {
            openModal('signout-modal');
        }

        async function performSignOut() {
            try {
                showLoading(true);
                closeModal('signout-modal');
                
                const result = await AuthService.signOut();
                console.log('Sign out result:', result);
                
                if (result.success) {
                    showNotification('Signed out successfully', 'success');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1000);
                } else {
                    console.warn('Sign out failed, but redirecting anyway:', result.error);
                    window.location.href = 'login.html';
                }
            } catch (error) {
                console.error('Sign out error:', error);
                showNotification('Sign out completed, redirecting...', 'warning');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
            } finally {
                showLoading(false);
            }
        }

        // Mobile sidebar functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            
            if (sidebar && overlay) {
                sidebar.classList.toggle('mobile-open');
                overlay.classList.toggle('active');
            }
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            
            if (sidebar && overlay) {
                sidebar.classList.remove('mobile-open');
                overlay.classList.remove('active');
            }
        }

        // Initialize Lucide icons globally
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }

        // Global variables for admin scripts compatibility
        window.AdminApp = window.AdminApp || { editingItemId: null };
    </script>

    <style>
        /* Fixed filter bar styling to match original design */
        .search-filter-bar {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 24px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        .search-box {
            position: relative;
            flex: 1;
            min-width: 200px;
        }

        .search-input {
            width: 100%;
            padding: 10px 16px 10px 40px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            width: 16px;
            height: 16px;
        }

        .filter-select {
            padding: 10px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            min-width: 140px;
            background: white;
        }

        /* Enhanced pagination styling */
        .pagination-btn {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #f8fafc;
            border-color: #cbd5e1;
        }

        .pagination-btn.active {
            background: #4338ca;
            color: white;
            border-color: #4338ca;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-ellipsis {
            padding: 8px 4px;
            color: #64748b;
        }

        /* Action buttons enhanced styling */
        .action-buttons {
            display: flex;
            gap: 4px;
            justify-content: center;
        }

        .btn-sm {
            width: 32px;
            height: 32px;
            padding: 6px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-sm:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn-sm i {
            width: 14px;
            height: 14px;
        }

        /* Form enhancements */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-group.half {
            grid-column: span 1;
        }

        .form-group {
            grid-column: span 2;
        }

        .rate-year-row {
            margin-bottom: 16px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .input-group {
            display: flex;
            align-items: center;
        }

        .input-prefix, .input-suffix {
            padding: 10px 12px;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            color: #6b7280;
            font-weight: 500;
            font-size: 14px;
        }

        .input-prefix {
            border-right: none;
            border-radius: 8px 0 0 8px;
        }

        .input-suffix {
            border-left: none;
            border-radius: 0 8px 8px 0;
        }

        .input-group .form-input {
            border-radius: 0;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .checkbox-option:hover {
            background: #e0e7ff;
            border-color: #c7d2fe;
        }

        .radio-group {
            display: flex;
            gap: 16px;
            margin-top: 8px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .radio-option:hover {
            background: #e0e7ff;
            border-color: #c7d2fe;
        }

        /* Status badge improvements */
        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-inactive {
            background: #f3f4f6;
            color: #374151;
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            max-width: 400px;
            animation: slideIn 0.3s ease;
        }

        .notification-success {
            border-left: 4px solid #10b981;
        }

        .notification-error {
            border-left: 4px solid #ef4444;
        }

        .notification-warning {
            border-left: 4px solid #f59e0b;
        }

        .notification-info {
            border-left: 4px solid #3b82f6;
        }

        .notification-content {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .notification-close {
            background: none;
            border: none;
            cursor: pointer;
            color: #6b7280;
            padding: 4px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Loading spinner */
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f4f6;
            border-top: 2px solid #4338ca;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-row {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .search-filter-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                min-width: auto;
            }

            .filter-select {
                min-width: auto;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .form-group.half {
                grid-column: span 1;
            }

            .checkbox-group {
                grid-template-columns: 1fr;
            }

            .radio-group {
                flex-direction: column;
            }

            .pagination {
                flex-direction: column;
                gap: 12px;
                align-items: center;
            }
        }
    </style>
</body>
</html>
